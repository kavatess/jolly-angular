<app-page-layout [scroll]="true" [onLoad]="false">
    <div class="page-content">
        <!-- select group -->
        <div id="input-group">
            <h6 class="text-center">Quản lý dữ liệu giàn</h6>

            <!-- select block -->
            <div class="form-item">
                <span class="text">Khu vực vườn:</span>
                <select class="form-control form-control-sm" (change)="changeBlock($event.target.value)">
                    <option *ngFor="let block of blockArr" [value]="block">{{ block }}</option>
                </select>
            </div>

            <!-- select truss -->
            <div class="form-item">
                <span class="text">Thứ tự máng:</span>
                <select class="form-control form-control-sm" (change)="selectTruss($event.target.value)">
                    <option *ngFor="let truss of trussArr" [value]="truss._id">{{ truss.block + truss.index }}</option>
                </select>
            </div>

            <!-- input display maxHole -->
            <div class="form-item">
                <span class="text">Số lỗ tối đa:</span>
                <input id="max-hole-ip" type="number" class="form-control form-control-sm" max="1200">
            </div>
        </div>

        <ng-template [ngIf]="selectedTruss">
            <!-- Recent truss status -->
            <div id="recent-status-info" class="card">
                <div class="card-header">
                    <h6 class="text-center">Tình trạng hiện tại của giàn</h6>
                </div>

                <div class="card-body">
                    <app-truss-timeline *ngIf="selectedTruss.realStatus.length" [history]="selectedTruss" [maxHole]="selectedTruss.maxHole">
                    </app-truss-timeline>
                    <div *ngIf="!selectedTruss.realStatus.length" class="text text-center">Máng hiện đang trống
                    </div>
                </div>
            </div>

            <!-- Truss history list -->
            <div id="history-info">
                <h6>Lịch sử giàn rau {{ selectedTruss.block + selectedTruss.index }}</h6>

                <app-collapse *ngFor="let history of historyArr" [collapseId]=" 'his-' + history._id ">
                    <div class="collapse-header">
                        <span class="text">{{ history.startDate | date: 'dd/MM/yyyy' }}</span>
                        <span class="fa-icon">
                            <i class="fas fa-arrow-alt-circle-right"></i>
                        </span>
                        <span class="text">{{ history.realStatus[history.realStatus.length - 1].date | date:
                            'dd/MM/yyyy'
                            }}</span>
                    </div>

                    <div class="collapse-body">
                        <app-truss-timeline [history]="history" [maxHole]="selectedTruss.maxHole"></app-truss-timeline>
                    </div>
                </app-collapse>
            </div>
        </ng-template>

        <ng-template [ngIf]="!selectedTruss">
            <div class="text">Dữ liệu về máng không tồn tại.</div>
        </ng-template>
    </div>

    <div class="footer">
        <!-- return button -->
        <button class="btn btn-sm left-btn-container" [routerLink]="['/settings']" routerLinkActive="active">
            <span class="fa-icon">
                <i class="fas fa-arrow-circle-left"></i>
            </span>
            <span class="text">Quay về</span>
        </button>
    </div>
</app-page-layout>